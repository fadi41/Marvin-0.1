<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marvin Settings</title> 
  <style>
    :root {
        --primary-color: #3a86ff;
        --secondary-color: #8338ec;
        --accent-color: #ff006e;
        --dark-color: #1a1a2e;
        --light-color: #f8f9fa;
        --danger-color: #dc3545;
        --success-color: #28a745;
        --transition: all 0.3s ease;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5; /* Consistent background */
      color: #333;
      display: flex;
      flex-direction: column; /* Ensure footer stays at bottom */
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex-grow: 1; /* Allow container to fill space */
    }
    /* Using header from index.html, removing duplicated nav/header here */
    .control-panel {
      display: grid;
      /* Adjusted grid for potentially more settings sections */
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      padding: 20px;
      margin-bottom: 20px; /* Spacing between cards if they stack */
      display: flex; /* Use flex for internal layout */
      flex-direction: column;
    }
    .card h2 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 0.5rem;
    }
    label {
        display: block; /* Ensure labels are on their own line */
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
    }
    textarea, input[type="text"], input[type="number"], input[type="password"], select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      box-sizing: border-box; /* Include padding in width */
    }
    textarea {
        min-height: 200px; /* Good default height for instructions */
        font-family: monospace;
        resize: vertical;
    }
    input[type="range"] {
        width: calc(100% - 50px); /* Adjust width to fit value display */
        vertical-align: middle;
    }
    #temperature-value {
        display: inline-block;
        width: 40px;
        text-align: right;
        font-weight: bold;
    }
    button {
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        margin-right: 10px; /* Spacing between buttons */
        margin-bottom: 10px; /* Spacing if buttons wrap */
    }
    button.primary {
        background-color: var(--primary-color);
        color: white;
    }
    button.primary:hover {
        background-color: #2a6bd1; /* Darker shade */
    }
    button.secondary {
        background-color: var(--secondary-color);
        color: white;
    }
     button.secondary:hover {
        background-color: #6a2cb3; /* Darker shade */
    }
    button.danger {
        background-color: var(--danger-color);
        color: white;
    }
    button.danger:hover {
        background-color: #b82a37; /* Darker shade */
    }
    .status {
      padding: 10px;
      margin-top: 15px;
      border-radius: 5px;
      border-left-width: 5px;
      border-left-style: solid;
    }
    .status.success {
        background-color: #d4edda;
        border-color: var(--success-color);
        color: #155724;
    }
    .status.error {
        background-color: #f8d7da;
        border-color: var(--danger-color);
        color: #721c24;
    }
    .status.info {
        background-color: #e2e3e5;
        border-color: #6c757d;
        color: #383d41;
    }

    .button-group {
        margin-top: 10px; /* Space above button group */
        display: flex;
        flex-wrap: wrap; /* Allow buttons to wrap on small screens */
        gap: 10px;
    }
  </style>
</head>
<body>
  {/* Navigation should be handled by index.html */} 
  {/* <header>...</header> - Removed */}
  {/* <nav>...</nav> - Removed */} 

  <div class="container">
     <h1>Marvin Settings</h1> {/* Main page title */} 

    <div class="control-panel">

      {/* System Instructions Card */} 
       <div class="card">
          <h2>System Instructions</h2>
          <label for="systemInstructions">Edit Marvin's core instructions:</label>
          <textarea id="systemInstructions" placeholder="Enter system instructions here..."></textarea>
          <div class="button-group">
            <button id="loadInstructionsBtn" class="secondary">Load from File</button>
            <button id="saveInstructionsBtn" class="primary">Save to File</button>
            {/* Hidden file input */} 
             <input type="file" id="instructionsFileInput" accept=".txt" style="display: none;" />
          </div>
          <div id="instructionsStatus" class="status info">Load or edit instructions.</div>
       </div>

      {/* Configuration Settings Card */} 
       <div class="card">
        <h2>API Configuration</h2>
        <label for="api-key">Gemini API Key:</label>
        <input type="password" id="api-key" placeholder="Enter your Gemini API key">

        <label for="gemini-url">Gemini API URL:</label>
        <input type="text" id="gemini-url" placeholder="Enter Gemini API URL" value="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent">
        
        {/* Removed less relevant settings for now, can be added back if needed */}
        {/* <label for="temperature">Temperature:</label>
        <div>
           <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" oninput="updateTemperatureValue()">
           <span id="temperature-value">0.7</span>
        </div> 
        <label for="max-tokens">Max Tokens:</label>
        <input type="number" id="max-tokens" min="1" max="4096" value="1024">
        <label for="endpoints">API Endpoints:</label> 
        <select id="endpoints">
          <option value="gemini" selected>Gemini API</option>
        </select> */}

        <div class="button-group">
            <button onclick="saveApiConfiguration()" class="primary">Save API Config</button>
        </div>
        <div id="configStatus" class="status info">API Configuration status.</div>
      </div>

       {/* Placeholder for other settings cards like Memory Management */} 
       {/* <div class="card">
            <h2>Memory Management</h2>
            </div> 
       */}

    </div> {/* End control-panel */} 
  </div> {/* End container */} 

  {/* Footer could be added back if this page is ever standalone */}
  {/* <footer>...</footer> */}

  <script>
    // DOM References
    const apiKeyInput = document.getElementById('api-key');
    const geminiUrlInput = document.getElementById('gemini-url');
    const configStatusDiv = document.getElementById('configStatus');
    const systemInstructionsTextarea = document.getElementById('systemInstructions');
    const instructionsFileInput = document.getElementById('instructionsFileInput');
    const loadInstructionsBtn = document.getElementById('loadInstructionsBtn');
    const saveInstructionsBtn = document.getElementById('saveInstructionsBtn');
    const instructionsStatusDiv = document.getElementById('instructionsStatus');

    // --- Configuration --- 
    function saveApiConfiguration() {
      const config = {
        // temperature: document.getElementById('temperature').value,
        // maxTokens: document.getElementById('max-tokens').value,
        // endpoint: document.getElementById('endpoints').value,
        apiKey: apiKeyInput.value,
        geminiUrl: geminiUrlInput.value
      };
      // Basic validation
      if (!config.apiKey) {
          updateStatus(configStatusDiv, 'API Key cannot be empty.', 'error');
          return;
      }
       if (!config.geminiUrl) {
           updateStatus(configStatusDiv, 'Gemini API URL cannot be empty.', 'error');
           return;
       }

      localStorage.setItem('marvin-api-config', JSON.stringify(config));
      updateStatus(configStatusDiv, 'API Configuration saved successfully.', 'success');
      // Optional: Log action if a logging mechanism exists
      // logAction('API Configuration settings saved'); 
    }

    function loadApiConfiguration() {
        const savedConfig = localStorage.getItem('marvin-api-config');
        if (savedConfig) {
            try {
                const config = JSON.parse(savedConfig);
                apiKeyInput.value = config.apiKey || '';
                geminiUrlInput.value = config.geminiUrl || 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent';
                // document.getElementById('temperature').value = config.temperature || 0.7;
                // updateTemperatureValue();
                // document.getElementById('max-tokens').value = config.maxTokens || 1024;
                // document.getElementById('endpoints').value = config.endpoint || 'gemini';
                updateStatus(configStatusDiv, 'Loaded saved API configuration.', 'info');
            } catch (error) {
                 updateStatus(configStatusDiv, `Error loading API config: ${error.message}`, 'error');
            }
        } else {
             updateStatus(configStatusDiv, 'No saved API configuration found. Please enter details.', 'info');
        }
    }

    // function updateTemperatureValue() {
    //   const temp = document.getElementById('temperature').value;
    //   document.getElementById('temperature-value').textContent = temp;
    // }

    // --- System Instructions --- 
    loadInstructionsBtn.addEventListener('click', () => instructionsFileInput.click());

    instructionsFileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file && file.type === "text/plain") {
            const reader = new FileReader();
            reader.onload = (e) => {
                systemInstructionsTextarea.value = e.target.result;
                updateStatus(instructionsStatusDiv, `Loaded instructions from ${file.name}.`, 'success');
                // Reset file input to allow loading the same file again if needed
                instructionsFileInput.value = null;
            };
            reader.onerror = (e) => {
                updateStatus(instructionsStatusDiv, 'Error reading instructions file.', 'error');
                 instructionsFileInput.value = null;
            };
            reader.readAsText(file);
        } else if (file) {
            updateStatus(instructionsStatusDiv, 'Please select a valid .txt file.', 'error');
            instructionsFileInput.value = null;
        }
    });

    saveInstructionsBtn.addEventListener('click', () => {
        const instructionsText = systemInstructionsTextarea.value;
        if (instructionsText.trim() === '') {
            updateStatus(instructionsStatusDiv, 'Cannot save empty instructions.', 'error');
            return;
        }
        // Note: This saves via browser download. 
        // To save directly to the server filesystem (e.g., 'Files/System Instructions v0.6.txt'),
        // we would need a backend endpoint or use the write_file tool if appropriate 
        // in the final implementation context.
        const blob = new Blob([instructionsText], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'marvin_system_instructions_v0.6.txt'; // Suggest a filename
        document.body.appendChild(link); // Required for Firefox
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href); // Clean up
        updateStatus(instructionsStatusDiv, 'Instructions prepared for download.', 'success');
    });

     // Helper function to update status divs
     function updateStatus(element, message, type = 'info') { // type can be 'info', 'success', 'error'
         element.textContent = message;
         element.className = `status ${type}`; // Reset classes and add new type
     }

    // --- Initialization --- 
    document.addEventListener('DOMContentLoaded', () => {
        loadApiConfiguration();
        updateStatus(instructionsStatusDiv, 'Load instructions from a file or edit directly.', 'info');
        // Potentially load existing instructions from a default file on load?
        // loadDefaultInstructions(); 
    });

    // Placeholder for loading default instructions on page load (e.g., from a known file path)
    // async function loadDefaultInstructions() {
    //    try {
    //        // Use read_file tool or fetch API 
    //        // const defaultInstructions = await readFileTool('Files/System iNStructions Marvin 0.6.txt'); 
    //        // systemInstructionsTextarea.value = defaultInstructions;
    //        // updateStatus(instructionsStatusDiv, 'Loaded default instructions.', 'info');
    //    } catch (error) {
    //         updateStatus(instructionsStatusDiv, 'Could not load default instructions.', 'error');
    //    }
    // }

  </script>
</body>
</html>
