<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marvin Settings</title>
  <style>
    :root {
        --primary-color: #3a86ff;
        --secondary-color: #8338ec;
        --accent-color: #ff006e;
        --dark-color: #1a1a2e;
        --light-color: #f8f9fa;
        --danger-color: #dc3545;
        --success-color: #28a745;
        --transition: all 0.3s ease;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f2f5; /* Consistent background */
      color: #333;
      display: flex;
      flex-direction: column; /* Ensure footer stays at bottom */
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex-grow: 1; /* Allow container to fill space */
    }
    /* Using header from index.html */
    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      padding: 20px;
      margin-bottom: 20px; /* Spacing between cards if they stack */
      display: flex; /* Use flex for internal layout */
      flex-direction: column;
    }
    .card h2 {
        color: var(--primary-color);
        margin-top: 0; /* Remove potential top margin */
        margin-bottom: 1rem;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 0.5rem;
        font-size: 1.25rem;
    }
    label {
        display: block; /* Ensure labels are on their own line */
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
    }
    textarea, input[type="text"], input[type="number"], input[type="password"], select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      box-sizing: border-box; /* Include padding in width */
    }
    textarea {
        min-height: 200px; /* Good default height for instructions */
        font-family: monospace;
        resize: vertical;
    }
    input[type="range"] {
        width: calc(100% - 50px); /* Adjust width to fit value display */
        vertical-align: middle;
    }
    #temperature-value {
        display: inline-block;
        width: 40px;
        text-align: right;
        font-weight: bold;
    }
    button {
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        margin-right: 10px; /* Spacing between buttons */
        margin-bottom: 10px; /* Spacing if buttons wrap */
    }
    button.primary {
        background-color: var(--primary-color);
        color: white;
    }
    button.primary:hover {
        background-color: #2a6bd1; /* Darker shade */
    }
    button.secondary {
        background-color: var(--secondary-color);
        color: white;
    }
     button.secondary:hover {
        background-color: #6a2cb3; /* Darker shade */
    }
    button.danger {
        background-color: var(--danger-color);
        color: white;
    }
    button.danger:hover {
        background-color: #b82a37; /* Darker shade */
    }
    .status {
      padding: 10px;
      margin-top: 15px;
      border-radius: 5px;
      border-left-width: 5px;
      border-left-style: solid;
      font-size: 0.9em;
    }
    .status.success {
        background-color: #d4edda;
        border-color: var(--success-color);
        color: #155724;
    }
    .status.error {
        background-color: #f8d7da;
        border-color: var(--danger-color);
        color: #721c24;
    }
    .status.info {
        background-color: #e2e3e5;
        border-color: #6c757d;
        color: #383d41;
    }

    .button-group {
        margin-top: auto; /* Push button group to bottom of card */
        padding-top: 1rem; /* Add space above buttons */
        display: flex;
        flex-wrap: wrap; /* Allow buttons to wrap on small screens */
        gap: 10px;
    }
    /* Ensure settings page title is visible */
    h1 {
        color: var(--dark-color);
        margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <!-- Navigation is handled by index.html -->

  <div class="container">
     <h1>Marvin Settings</h1> <!-- Main page title -->

    <div class="control-panel">

      <!-- System Instructions Card -->
       <div class="card">
          <h2>System Instructions</h2>
          <label for="systemInstructions">Edit Marvin's core instructions:</label>
          <textarea id="systemInstructions" placeholder="Enter system instructions here..."></textarea>
          <div class="button-group">
            <button id="loadInstructionsBtn" class="secondary">Load from File</button>
            <button id="saveInstructionsBtn" class="primary">Save to File</button>
            <!-- Hidden file input -->
             <input type="file" id="instructionsFileInput" accept=".txt" style="display: none;" />
          </div>
          <div id="instructionsStatus" class="status info">Load or edit instructions.</div>
       </div>

      <!-- Configuration Settings Card -->
       <div class="card">
        <h2>API Configuration</h2>
        <label for="api-key">Gemini API Key:</label>
        <input type="password" id="api-key" placeholder="Enter your Gemini API key">

        <label for="gemini-url">Gemini API URL:</label>
        <input type="text" id="gemini-url" placeholder="Enter Gemini API URL" value="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent">

        <!-- Removed less relevant settings for now -->

        <div class="button-group">
            <button onclick="saveApiConfiguration()" class="primary">Save API Config</button>
        </div>
        <div id="configStatus" class="status info">API Configuration status.</div>
      </div>

       <!-- Placeholder for other settings cards -->
       <!-- <div class="card">
            <h2>Memory Management</h2>
            <textarea placeholder="Memory log content here..."></textarea>
            <div class="button-group">
                <button class="secondary">Load Memory</button>
                <button class="primary">Save Memory</button>
            </div>
            <div class="status info">Memory status.</div>
         </div> -->

    </div> <!-- End control-panel -->
  </div> <!-- End container -->

  <!-- Footer could be added back if this page is ever standalone -->
  <!-- <footer>...</footer> -->

  <script>
    // DOM References
    const apiKeyInput = document.getElementById('api-key');
    const geminiUrlInput = document.getElementById('gemini-url');
    const configStatusDiv = document.getElementById('configStatus');
    const systemInstructionsTextarea = document.getElementById('systemInstructions');
    const instructionsFileInput = document.getElementById('instructionsFileInput');
    const loadInstructionsBtn = document.getElementById('loadInstructionsBtn');
    const saveInstructionsBtn = document.getElementById('saveInstructionsBtn');
    const instructionsStatusDiv = document.getElementById('instructionsStatus');

    // --- Configuration --- 
    function saveApiConfiguration() {
      const config = {
        apiKey: apiKeyInput.value,
        geminiUrl: geminiUrlInput.value
      };
      // Basic validation
      if (!config.apiKey) {
          updateStatus(configStatusDiv, 'API Key cannot be empty.', 'error');
          return;
      }
       if (!config.geminiUrl) {
           updateStatus(configStatusDiv, 'Gemini API URL cannot be empty.', 'error');
           return;
       }

      localStorage.setItem('marvin-api-config', JSON.stringify(config));
      updateStatus(configStatusDiv, 'API Configuration saved successfully.', 'success');
      // Optional: Log action if a logging mechanism exists
      // logAction('API Configuration settings saved'); 
    }

    function loadApiConfiguration() {
        const savedConfig = localStorage.getItem('marvin-api-config');
        if (savedConfig) {
            try {
                const config = JSON.parse(savedConfig);
                apiKeyInput.value = config.apiKey || '';
                geminiUrlInput.value = config.geminiUrl || 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent';
                updateStatus(configStatusDiv, 'Loaded saved API configuration.', 'info');
            } catch (error) {
                 updateStatus(configStatusDiv, `Error loading API config: ${error.message}`, 'error');
            }
        } else {
             updateStatus(configStatusDiv, 'No saved API configuration found. Please enter details.', 'info');
        }
    }

    // --- System Instructions --- 
    loadInstructionsBtn.addEventListener('click', () => instructionsFileInput.click());

    instructionsFileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file && file.type === "text/plain") {
            const reader = new FileReader();
            reader.onload = (e) => {
                systemInstructionsTextarea.value = e.target.result;
                updateStatus(instructionsStatusDiv, `Loaded instructions from ${file.name}.`, 'success');
                instructionsFileInput.value = null; // Reset file input
            };
            reader.onerror = (e) => {
                updateStatus(instructionsStatusDiv, 'Error reading instructions file.', 'error');
                 instructionsFileInput.value = null;
            };
            reader.readAsText(file);
        } else if (file) {
            updateStatus(instructionsStatusDiv, 'Please select a valid .txt file.', 'error');
            instructionsFileInput.value = null;
        }
    });

    saveInstructionsBtn.addEventListener('click', () => {
        const instructionsText = systemInstructionsTextarea.value;
        if (instructionsText.trim() === '') {
            updateStatus(instructionsStatusDiv, 'Cannot save empty instructions.', 'error');
            return;
        }
        // Saves via browser download
        const blob = new Blob([instructionsText], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'marvin_system_instructions_v0.6.txt'; // Suggest a filename
        document.body.appendChild(link); // Required for Firefox
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href); // Clean up
        updateStatus(instructionsStatusDiv, 'Instructions prepared for download.', 'success');
    });

     // Helper function to update status divs
     function updateStatus(element, message, type = 'info') { // type can be 'info', 'success', 'error'
         element.textContent = message;
         element.className = `status ${type}`; // Reset classes and add new type
     }

    // --- Initialization --- 
    document.addEventListener('DOMContentLoaded', () => {
        loadApiConfiguration();
        updateStatus(instructionsStatusDiv, 'Load instructions from a file or edit directly.', 'info');
        // loadDefaultInstructions(); // Consider adding this back
    });

    // Placeholder for loading default instructions on page load
    // async function loadDefaultInstructions() {
    //    try {
    //        // Example: Fetching from a specific file
    //        // const response = await fetch('Files/System iNStructions Marvin 0.6.txt');
    //        // if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    //        // const text = await response.text();
    //        // systemInstructionsTextarea.value = text;
    //        // updateStatus(instructionsStatusDiv, 'Loaded default instructions.', 'info');
    //    } catch (error) {
    //         updateStatus(instructionsStatusDiv, `Could not load default instructions: ${error.message}`, 'error');
    //    }
    // }

  </script>
</body>
</html>
